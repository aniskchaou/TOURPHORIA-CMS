jQuery(document).ready(function(t){function a(a){var e=a.calendar.fullCalendar("getDate").format("M");t(".calendar_change_month").val(e)}function e(a,e,d,c){var l=t(".package-info-wrapper"),s=t(".overlay-form",l);s.hide(),n=t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_starttime_tour_frontend",tour_id:a,check_in:e,check_out:d},beforeSend:function(){s.show(),o.addClass("loading")},success:function(a){if(null!=a.data&&a.data.length>0){t("#starttime_tour option").remove(),t("#starttime_box").show();var e="";for(i=0;i<a.data.length;i++){"-1"==a.check[i]?a.data[i]==c?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+"</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+"</option>":"0"==a.check[i]?a.data[i]==c?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":a.data[i]==c?"1"==a.check[i]?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>":"1"==a.check[i]?e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>"}t("#starttime_tour option").remove(),t("#starttime_tour").append(e),s.hide(),o.removeClass("loading")}else t("#starttime_box").hide(),s.hide();r=!1}}),r=!0}var n,o=t(".st-inbox-form-book"),r=!1;if(t('[data-toggle="tooltip"]').tooltip(),t(document).ajaxStop(function(){t(".overlay-form").fadeOut(500)}),t("#check_in").length){var d=t("#check_in").val();d!=(c=t("#check_out").val())?t("input#check_out").parent().parent().show():t("input#check_out").parent().parent().hide();if("daily_tour"==t('input[name="type_tour"]').val()){var c=t("#check_in").val();t("input#check_out").parent().hide()}if(""!=d){var l=t("#starttime_hidden_load_form").data("tourid"),s=t("#starttime_hidden_load_form").data("starttime");""!=s&&void 0!==s&&(""==c&&(c=d),e(l,d,c,s))}}t("#select-a-tour").length&&t("#select-a-tour").qtip({content:{text:t("#list_tour_item").html()},show:{when:"click",solo:!0},hide:"unfocus",api:{onShow:function(){t(".calendar-wrapper").each(function(o,i){var d=t(this),c=new function(a){var o=this;this.container=a,this.calendar=null,this.form_container=null,this.init=function(){o.container=a,o.calendar=t(".calendar-content",o.container),o.form_container=t(".calendar-form",o.container),o.initCalendar()},this.initCalendar=function(){var a=o.calendar.data("hide_adult"),i=o.calendar.data("hide_children"),d=o.calendar.data("hide_infant"),c=o.calendar.data("price-type"),l=t(".calendar-wrapper").data("current-date");o.calendar.fullCalendar({defaultDate:l,firstDay:1,lang:st_params.locale,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){o.calendar.fullCalendar("refetchEvents")}}},header:{left:"prev",center:"title",right:"next"},contentHeight:360,select:function(t,a,e,n){var r=new Date(t._d).toString("MM"),i=new Date(a._d).toString("MM"),d=(new Date).toString("MM");(r<d||i<d)&&o.calendar.fullCalendar("unselect")},events:function(a,e,n,r){t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_tour_frontend",tour_id:o.container.data("post-id"),start:a.unix(),end:e.unix()},success:function(t){"object"==typeof t&&r(t)},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventClick:function(t,a,e){o.calendar.trigger("st.select.tour.frontend",[t,a,e])},eventMouseover:function(t,a,e){},eventMouseout:function(t,a,e){},eventRender:function(l,s,u){var p=o.calendar.fullCalendar("getDate").format("MM"),_="";t.fullCalendar.moment(l.start._i).format("MM")!=p&&(_="next_month");var f=l.day,m="none";void 0!==l.date_end&&(f+=" - "+l.date_end,m="group");var h=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();if("available"==l.status){var v="";"person"==c?("on"!=a&&(v+=st_checkout_text.adult_price+": "+l.adult_price+" <br/>"),"on"!=i&&(v+=st_checkout_text.child_price+": "+l.child_price+" <br/>"),"on"!=d&&(v+=st_checkout_text.infant_price+": "+l.infant_price)):v+=st_checkout_text.price+": "+l.base_price;var g="data-starttime='n'";""!=l.starttime&&null!=l.starttime&&(v+='<br /><i class="fa fa-clock-o" aria-hidden="true"></i> '+l.starttime,g="data-starttime='y'"),f="<button "+g+" data-placement='top' title  = '"+v+"' data-toggle='tooltip' class='"+m+" "+_+" btn btn-available'>"+f}else f="<button disabled data-placement='top' title  = 'Disabled' data-toggle='tooltip' class='"+m+" btn btn-disabled'>"+f;h===l.date&&(f+="<span class='triangle'></span>"),f+="</button>",s.addClass("event-"+l.id),s.addClass("event-number-"+l.start.unix()),t(".fc-content",s).html(f),o.calendar.trigger("st_render_calendar_frontend",[l,s,u]),s.bind("click",function(a,i,d){var c="",s="";t(this).find("button").hasClass("btn-available")&&(t(".fc-day-grid-event").removeClass("st-active"),t(this).addClass("st-active"),date=t.fullCalendar.moment(l.start._i),t("input#check_in").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),c=date.format(st_params.date_format_calendar.toUpperCase()),void 0!==l.end&&l.end&&void 0!==l.end._i?(date=new Date(l.end._i),date.setDate(date.getDate()-1),date=t.fullCalendar.moment(date),s=date.format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().parent().show()):(date=t.fullCalendar.moment(l.start._i).format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date).parent().parent().hide()),t("input#adult_price").val(l.adult_price),t("input#child_price").val(l.child_price),t("input#infant_price").val(l.infant_price),t(".page-template-template-user .qtip").length&&t("#select-a-tour").length&&t("#select-a-tour").qtip("hide"),r&&n.abort(),"y"==t(this).find("button").data("starttime")?(""==s&&(s=c),e(o.container.data("post-id"),c,s,"")):(t("#starttime_tour option").remove(),t("#starttime_box").hide()))})},eventAfterRender:function(a,e,n){t('[data-toggle="tooltip"]').tooltip({html:!0})},loading:function(a,e){a?t(".calendar-wrapper-inner .overlay-form").fadeIn():t(".calendar-wrapper-inner .overlay-form").fadeOut()}})}}(d);c.init(),t("body").on("calendar.change_month",function(t,a){var e=c.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),c.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))});var l=!1;t("body").on("click",".st-tour-tabs-content .request",function(){if(!l){var t=d.data("current-date");""!=t&&setTimeout(function(){c.calendar.fullCalendar("gotoDate",t),l=!0},1e3)}}),a(c),t(".fc-next-button, .fc-prev-button").click(function(){a(c)})})}}})});