jQuery(document).ready(function(t){function a(a){var e=a.calendar.fullCalendar("getDate").format("M");t(".calendar_change_month").val(e)}var e,n=function(a){var n=this;this.container=a,this.calendar=null,this.form_container=null,this.init=function(){n.container=a,n.calendar=t(".calendar-content",n.container),n.form_container=t(".calendar-form",n.container),n.initCalendar()},this.initCalendar=function(){var a=n.calendar.data("start");n.calendar.fullCalendar({firstDay:1,lang:st_params.locale,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){n.calendar.fullCalendar("refetchEvents")}}},header:{left:"prev",center:"title",right:"next, "},contentHeight:360,events:function(a,e,l,i){t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_rental_single",post_id:n.container.data("post-id"),start:a.unix(),end:e.unix()},success:function(t){"object"==typeof t&&i(t)},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventClick:function(a,n,l){var i="off";if(t("#rental_is_groupday").length&&(i="on"==t("#rental_is_groupday").val()?"on":"off"),"on"==i)if(t(this).find("button").hasClass("is_group_day")){e=t(this),date=new Date(a.start._i),date.setDate(date.getDate()),date=t.fullCalendar.moment(date),check_in=date.format("YYYY-MM-DD");var d=date.format(st_params.date_format_calendar.toUpperCase());date=new Date(a.end._i),date.setDate(date.getDate()-1),date=t.fullCalendar.moment(date),check_out=date.format("YYYY-MM-DD");var s=date.format(st_params.date_format_calendar.toUpperCase()),r=(Date.parse(check_out),'<div id="gdate-choose" class="mfp-with-anim mfp-dialog mfp-search-dialog mfp-hide gdate-choose-box"><ul>');r+='<li><div class="gdate-choose-item btn btn-primary" id="gdate_start_item" data-date="'+d+'">'+d+"</div></li>",r+='<li><div class="gdate-choose-item btn btn-primary" id="gdate_end_item" data-date="'+s+'">'+s+"</div></li>",r+='<li><div class="gdate-choose-item btn btn-primary" id="gdate_all_item" data-start-date="'+d+'" data-end-date="'+s+'">'+d+" - "+s+"</li></div></ul></div>",t("#gdate-choose").remove(),t(this).find("button.is_group_day").append(r),t(this).find("button").hasClass("btn-disabled-gd")||t(this).find("button").hasClass("btn-disabled")||t.magnificPopup.open({items:{src:"#gdate-choose"}})}else if(""==t("input#field-rental-start").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val()){if(!t(this).find("button").hasClass("btn-available")&&!t(this).find("button").hasClass("btn-available_allow_fist")&&!t(this).find("button").hasClass("btn-available_allow_last"))return;t(".fc-day-grid-event").removeClass("st-active"),t(".fc-day-grid-event").removeClass("current-select"),t(this).addClass("st-active");t(this);date=t.fullCalendar.moment(a.start._i),t("input#field-rental-start").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),t("input#field-rental-end").val(""),t(this).addClass("current-select");var o=0;t(".fc-day-grid-event").each(function(){if(o++,t(this).hasClass("current-select"))return!1}),t(".fc-day-grid-event").each(function(a){a<o&&t(this).find("button").hasClass("btn-available")&&(t(this).find("button").removeClass("btn-available").addClass("btn-disabled-gd"),t(this).find("button").attr("disabled",!0),t(this).find(".tooltip").remove())})}else if(""==t("input#field-rental-end").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val()){if(!t(this).find("button").hasClass("btn-available")&&!t(this).find("button").hasClass("btn-available_allow_fist")&&!t(this).find("button").hasClass("btn-available_allow_last"))return;t(this).addClass("st-active"),date=t.fullCalendar.moment(a.start._i),t("input#field-rental-end").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),t(".page-template-template-user .qtip").length&&t("#select-a-rental").length&&t("#select-a-rental").qtip("hide")}},eventRender:function(a,e,n){var l="",i="",d="btn-disabled",s="disabled",r=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();a.status,a.status,a.status,"available"==a.status&&(d="btn-available",s="",i=st_checkout_text.origin_price+": "+a.price),"available_allow_fist"==a.status&&(d="btn-available btn-calendar btn-available_allow_fist available_allow_fist",s="",i=st_checkout_text.origin_price+": "+a.price),"available_allow_last"==a.status&&(d="btn-available btn-calendar btn-available_allow_last available_allow_last",s="",i=st_checkout_text.origin_price+": "+a.price);var o="";void 0!==a.date_end&&(o="is_group_day"),l+="<button  "+s+" data-toggle='tooltip' data-placement='top' class= '"+d+" btn "+o+"' title ='"+i+"''>"+a.day,void 0!==a.date_end&&(l+=" - "+a.date_end),r===a.date&&(l+="<span class='triangle'></span>"),l+="</button>",t(".fc-content",e).html(l)},eventAfterRender:function(a,e,n){t('[data-toggle="tooltip"]').tooltip({html:!0})},loading:function(a,e){a?t(".calendar-wrapper-inner .overlay-form").fadeIn():t(".calendar-wrapper-inner .overlay-form").fadeOut()},defaultDate:t.fullCalendar.moment(a)})}};t(".calendar-wrapper").length&&t(".calendar-wrapper").each(function(e,l){var i=t(this),d=new n(i);setTimeout(function(){d.init(),a(d),t(".fc-next-button, .fc-prev-button").click(function(){a(d)})},100),t("body").on("calendar.change_month",function(t,a){var e=d.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),d.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))})}),t("a.button-readmore").click(function(){t("#read-more").length>0&&(t("#read-more").removeClass("hidden"),t(this).addClass("hidden"),t("#show-description").remove())}),t(document).on("click","#gdate-choose .gdate-choose-item",function(){switch(t(this).attr("id")){case"gdate_start_item":if(""==t("input#field-rental-start").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val()){t("input#field-rental-start").val(t(this).data("date")).parent().show(),t("input#field-rental-end").val(""),t(".fc-day-grid-event").removeClass("st-active"),t(".fc-day-grid-event").removeClass("current-select"),e.addClass("st-active"),e.addClass("current-select");a=0;t(".fc-day-grid-event").each(function(){if(a++,t(this).hasClass("current-select"))return!1}),t(".fc-day-grid-event").each(function(e){e<a-1&&t(this).find("button").hasClass("btn-available")&&(t(this).find("button").removeClass("btn-available").addClass("btn-disabled-gd"),t(this).find("button").attr("disabled",!0),t(this).find(".tooltip").remove())})}else(""==t("input#field-rental-end").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val())&&(t("input#field-rental-end").val(t(this).data("date")).parent().show(),e.addClass("st-active"));break;case"gdate_end_item":if(""==t("input#field-rental-start").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val()){t("input#field-rental-start").val(t(this).data("date")).parent().show(),t("input#field-rental-end").val(""),t(".fc-day-grid-event").removeClass("st-active"),t(".fc-day-grid-event").removeClass("current-select"),e.addClass("st-active"),e.addClass("current-select");var a=0;t(".fc-day-grid-event").each(function(){if(a++,t(this).hasClass("current-select"))return!1}),t(".fc-day-grid-event").each(function(e){e<a&&t(this).find("button").hasClass("btn-available")&&(t(this).find("button").removeClass("btn-available").addClass("btn-disabled-gd"),t(this).find("button").attr("disabled",!0),t(this).find(".tooltip").remove())})}else(""==t("input#field-rental-end").val()||""!=t("input#field-rental-start").val()&&""!=t("input#field-rental-end").val())&&(t("input#field-rental-end").val(t(this).data("date")).parent().show(),e.addClass("st-active"));break;case"gdate_all_item":t(".fc-day-grid-event").removeClass("st-active"),e.addClass("st-active"),t("input#field-rental-start").val(t(this).data("start-date")).parent().show(),t("input#field-rental-end").val(t(this).data("end-date")).parent().show(),t(".fc-day-grid-event").removeClass("current-select"),t(".fc-day-grid-event").each(function(a){t(this).find("button").hasClass("btn-disabled-gd")&&(t(this).find("button").removeClass("btn-disabled-gd").addClass("btn-available"),t(this).find("button").removeAttr("disabled"))})}t.magnificPopup.close()}),t(document).on("click","#clear-gdate-rental",function(a){a.preventDefault(),t("input#field-rental-start").val(""),t("input#field-rental-end").val(""),t(".fc-day-grid-event").removeClass("st-active"),t(".fc-day-grid-event").removeClass("current-select"),t(".fc-day-grid-event").each(function(a){t(this).find("button").hasClass("btn-disabled-gd")&&(t(this).find("button").removeClass("btn-disabled-gd").addClass("btn-available"),t(this).find("button").removeAttr("disabled"))})}),t("#select-a-rental").length&&t("#select-a-rental").qtip({content:{text:t("#list_rental_item").html()},show:{when:"click",solo:!0},hide:"unfocus",api:{onShow:function(){t(".calendar-wrapper").each(function(e,l){var i=t(this),d=new n(i);d.init(),t("body").on("calendar.change_month",function(t,a){var e=d.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),d.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))});var s=i.data("current-date");""!=s&&d.calendar.fullCalendar("gotoDate",s),a(d),t(".fc-next-button, .fc-prev-button").click(function(){a(d)})})}}})});