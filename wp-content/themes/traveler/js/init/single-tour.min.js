jQuery(document).ready(function(t){function a(a,e,n){var r={tour_id:n,year:e,action:"st_get_disable_date_tour"};t.post(st_params.ajax_url,r,function(e){""!=e&&(d=e),booking_period=a.data("booking-period"),a.datepicker("setStartDate","+"+booking_period+"d"),t(".overlay-form").fadeOut(500)},"json")}function e(a){var e=a.calendar.fullCalendar("getDate").format("M");t(".calendar_change_month").val(e)}function n(a,e,n,d){var c=t(".package-info-wrapper"),l=t(".overlay-form",c);l.hide(),r=t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_starttime_tour_frontend",tour_id:a,check_in:e,check_out:n},beforeSend:function(){l.show()},success:function(a){if(null!=a.data&&a.data.length>0){t("#starttime_tour option").remove(),t("#starttime_box").show();var e="";for(i=0;i<a.data.length;i++){"-1"==a.check[i]?a.data[i]==d?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+"</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+"</option>":"0"==a.check[i]?a.data[i]==d?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":a.data[i]==d?"1"==a.check[i]?e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" selected >'+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>":"1"==a.check[i]?e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" >'+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>"}t("#starttime_tour option").remove(),t("#starttime_tour").append(e),l.hide()}else t("#starttime_box").hide(),l.hide();o=!1}}),o=!0}var r,o=!1;if(!(t(".st_single_tour").length<1)){t('[data-toggle="tooltip"]').tooltip();var d=[];if(t("input.tour_book_date").length>0?(t("input.tour_book_date").each(function(e,n){t(this).datepicker({language:st_params.locale,format:t(this).data("date-format"),todayHighlight:!0,autoclose:!0,startDate:"today",weekStart:1}),date_start=t(this).datepicker("getDate"),t(this).datepicker("addNewClass","booked");var r=t(this);null==date_start&&(date_start=new Date),year_start=date_start.getFullYear(),tour_id=t(this).data("tour-id"),a(r,year_start,tour_id)}),t("input.tour_book_date").on("changeYear",function(e){var n=t(this);year=new Date(e.date).getFullYear(),tour_id=t(this).data("tour-id"),a(n,year,tour_id)})):t(".package-info-wrapper .overlay-form").fadeOut(500),t(document).ajaxStop(function(){t(".overlay-form").fadeOut(500)}),t("#check_in").length){var c=t("#check_in").val();c!=(l=t("#check_out").val())?t("input#check_out").parent().show():t("input#check_out").parent().hide();if("daily_tour"==t('input[name="type_tour"]').val()){var l=t("#check_in").val();t("input#check_out").parent().hide()}if(""!=c){var s=t("#starttime_hidden_load_form").data("tourid"),u=t("#starttime_hidden_load_form").data("starttime");""!=u&&void 0!==u&&n(s,c,l,u)}}var _=function(a){var e=this;this.container=a,this.calendar=null,this.form_container=null,this.init=function(){e.container=a,e.calendar=t(".calendar-content",e.container),e.form_container=t(".calendar-form",e.container),e.initCalendar()},this.initCalendar=function(){var a=e.calendar.data("hide_adult"),i=e.calendar.data("hide_children"),d=e.calendar.data("hide_infant"),c=e.calendar.data("price-type"),l=t(".calendar-wrapper").data("current-date");e.calendar.fullCalendar({defaultDate:l,firstDay:1,lang:st_params.locale,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){e.calendar.fullCalendar("refetchEvents")}}},header:{left:"prev",center:"title",right:"next"},contentHeight:360,select:function(t,a,n,r){var o=new Date(t._d).toString("MM"),i=new Date(a._d).toString("MM"),d=(new Date).toString("MM");(o<d||i<d)&&e.calendar.fullCalendar("unselect")},events:function(a,n,r,o){t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_tour_frontend",tour_id:e.container.data("post-id"),start:a.unix(),end:n.unix()},success:function(t){"object"==typeof t&&o(t)},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventClick:function(t,a,n){e.calendar.trigger("st.select.tour.frontend",[t,a,n])},eventMouseover:function(t,a,e){},eventMouseout:function(t,a,e){},eventRender:function(l,s,u){var _=e.calendar.fullCalendar("getDate").format("MM"),p="";t.fullCalendar.moment(l.start._i).format("MM")!=_&&(p="next_month");var f=l.day,h="none";void 0!==l.date_end&&(f+=" - "+l.date_end,h="group");var m=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();if("available"==l.status){var v="";"person"==c?("on"!=a&&(v+=st_checkout_text.adult_price+": "+l.adult_price+" <br/>"),"on"!=i&&(v+=st_checkout_text.child_price+": "+l.child_price+" <br/>"),"on"!=d&&(v+=st_checkout_text.infant_price+": "+l.infant_price)):v+=st_checkout_text.price+": "+l.base_price;var g="data-starttime='n'";""!=l.starttime&&null!=l.starttime&&(v+='<br /><i class="fa fa-clock-o" aria-hidden="true"></i> '+l.starttime,g="data-starttime='y'"),f="<button "+g+" data-placement='top' title  = '"+v+"' data-toggle='tooltip' class='"+h+" "+p+" btn btn-available'>"+f}else f="<button disabled data-placement='top' title  = 'Disabled' data-toggle='tooltip' class='"+h+" btn btn-disabled'>"+f;m===l.date&&(f+="<span class='triangle'></span>"),f+="</button>",s.addClass("event-"+l.id),s.addClass("event-number-"+l.start.unix()),t(".fc-content",s).html(f),e.calendar.trigger("st_render_calendar_frontend",[l,s,u]),s.bind("click",function(a,i,d){var c="",s="";if(t(this).find("button").hasClass("btn-available")){t(".fc-day-grid-event").removeClass("st-active"),t(this).addClass("st-active"),date=t.fullCalendar.moment(l.start._i),t("input#check_in").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),c=date.format("YYYY-MM-DD"),void 0!==l.end&&l.end&&void 0!==l.end._i?(date=new Date(l.end._i),date.setDate(date.getDate()-1),date=t.fullCalendar.moment(date),s=date.format("YYYY-MM-DD"),t("input#check_out").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show()):(date=t.fullCalendar.moment(l.start._i).format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date).parent().hide()),t("input#adult_price").val(l.adult_price),t("input#child_price").val(l.child_price),t("input#infant_price").val(l.infant_price),t(".single-st_tours .qtip").length&&t(".single-st_tours .qtip").hide(),o&&r.abort();"y"==t(this).find("button").data("starttime")?n(e.container.data("post-id"),c,s,""):(t("#starttime_tour option").remove(),t("#starttime_box").hide())}})},eventAfterRender:function(a,e,n){t('[data-toggle="tooltip"]').tooltip({html:!0})},loading:function(a,e){a?t(".calendar-wrapper-inner .overlay-form").fadeIn():t(".calendar-wrapper-inner .overlay-form").fadeOut()}})}};t("#select-a-tour").length<=0&&t(".calendar-wrapper").each(function(a,n){var r=t(this),o=new _(r);o.init(),t("body").on("calendar.change_month",function(t,a){var e=o.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),o.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))});var i=!1;t("body").on("click",".st-tour-tabs-content .request",function(){if(!i){var t=r.data("current-date");""!=t&&setTimeout(function(){o.calendar.fullCalendar("gotoDate",t),i=!0},1e3)}}),e(o),t(".fc-next-button, .fc-prev-button").click(function(){e(o)})}),t("a.request").length>0&&"#request"==window.location.hash&&t("a.request").trigger("click"),t("#select-a-tour").length&&t("#select-a-tour").length&&t("#select-a-tour").qtip({content:{text:t("#list_tour_item").html()},show:{when:"click",solo:!0},hide:"unfocus",api:{onShow:function(){t(".calendar-wrapper").each(function(a,e){var n=t(this);new _(n).init()})}}})}});